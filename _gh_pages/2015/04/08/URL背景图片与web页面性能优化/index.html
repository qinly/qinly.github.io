
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>base64：URL背景图片与web页面性能优化</title>
    <meta name="description" content="">
    <meta name="author" content="GuoQing. Lai.">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Qing 个人博客</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/test.html">测试页面</a></li>
      	
      
    
  



          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>base64：URL背景图片与web页面性能优化 </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>08 April 2015</span>
    </div>
    <div class="content">
      <h2 id="base64urlweb">base64：URL背景图片与web页面性能优化</h2>

<p>原文地址:<a href="http://www.poluoluo.com/jzxy/201206/166976_3.html">原文</a></p>

<p>下文不再考虑IE 8以下浏览器！</p>

<p>一、base64百科</p>

<p>Base64是网络上最常见的用于传输8Bit字节代码的编码方式之一，可用于在HTTP环境下传递较长的标识信息。</p>

<p>例如下面这个：</p>

<p><img src="data:image/gif;base64,R0lGODlhAwADAIABAL6+vv///yH5BAEAAAEALAAAAAADAAMAAAIDjA9WADs=" /></p>

<p>二、base64与文件数据编码</p>

<p>在网络中，通过HTTP传输的文件还可以通过base64对数据进行编码进行传输。就如上面的这个base64的gif格式图片。当然，可以base64编码的文件不仅仅是图片，也可以是字体文件，例如（中间有缺省）：</p>

<p>@font-face{</p>

<p>font-family: forTest;</p>

<p>src:url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAh4 … RFERuENEGADl7JlY=) format(‘woff’);</p>

<p>}</p>

<p>自然，对于background-image图片，我们也可以使用base64编码进行传输，例如：</p>

<p>background-image:url(data:image/gif;base64,R0lGODlhBAABAIABAMLBwfLx8SH5BAEAAAEALAAAAAAEAAEAAAICRF4AOw==);</p>

<p>而使用base64编码作为background-image图片就是本文要着重阐述的。</p>

<p>三、如何获得图片的base64编码</p>

<p>其实在我之前“基于HTML5的可预览多图片Ajax上传”以及“zSlide-基于CSS3/HTML5演示文档jQuery插件”实际上就与图片的base64编码的获取打过交道了。如下本地图片转换成可预览的base64编码的核心脚本：</p>

<p>var reader = new FileReader(), htmlImage;</p>

<p>reader.onload = function(e) {</p>

<p>htmlImage = ‘<img src="'+ e.target.result +'" />’; // 这里e.target.result就是base64编码</p>

<p>}</p>

<p>reader.readAsDataURL(file);</p>

<p>上面说的你只需要了解，实际上，目前base64编码工具不少，对于我们前端制作，下面这个本地图片 base64编码获取页面是值得推荐的：Encode Data URL By PuterJam</p>

<p>直接将桌面图片拖到条条里就有了响应的background-image url属性可用的base64地址了：</p>

<p>在线获取本地图片base64编码使用示例 张鑫旭-鑫空间-鑫生活</p>

<p>该转换页面的原理就是上面所说的HTML5 文件本地预览原理，具体可以自己查阅资料。</p>

<p>四、使用base64:URL的优缺点</p>

<p>个人觉得base64:URL传输图片文件的好处在于：</p>

<p>1.减少了HTTP请求</p>

<p>2.某些文件可以避免跨域的问题</p>

<p>3.没有图片更新要重新上传，还要清理缓存的问题</p>

<p>不足在于：</p>

<p>1.浏览器支持</p>

<p>使用base64编码图片作为背景图片的这种技术IE6/IE7浏览器是不支持的（IE9浏览器IE7模式下支持，这里被@前端的那点破事鄙视了 ）。对于目前PC页面，兼容性问题使没有文件上传以及无需更新缓存的优点不存在了。</p>

<p>2.增加了CSS文件的尺寸</p>

<p>base64编码图片本质上是将图片的二进制大小以一些字母的形式展示，例如一个1024字节的图片，base64编码后至少1024个字符，这个大小会被完全嵌入到CSS文件中（不过幸运的是也可以被gzip了，而图片文件被gzip效果不明显）。</p>

<p>3.编码成本</p>

<p>图片完成后还需要base64编码，目前估计手工完成的多，因此，增加了一定的工作量，虽然不多。
1 2 下一页</p>

<p>五、优缺点权衡下的实际应用价值</p>

<p>权衡上面所展示的优缺点，貌似base64:URL图片没有什么用武之地啊，实际上非也，有一种情况时有base64编码作为background-image背景图片利要远大于弊的。何种情况呢？</p>

<p>在web页面制作的时候，由于某些现实原因，我们可以会用到下面这一类图片：</p>

<p>1.这类图片不能与其他图片以CSS Sprite的形式存在，只能独行</p>

<p>2.这类图片从诞生之日起，基本上很少被更新</p>

<p>3.这类图片的实际尺寸很小</p>

<p>4.这
类图片在网站中大规模使用</p>

<p>想想看，你的网站中有没有同时满足上面四条的背景图片呢？</p>

<p>//zxx： 假设已经过去了今天朝鲜火箭勃起的时间</p>

<p>怎样，想到了没？提点下，例如下面这个企鹅微博中的loading gif图片（537字节，勉强算是）：</p>

<p>加载中</p>

<p>537字节的大小实际上还是偏大了点，让我们看个更better的例子，大家可以去豆瓣首页，可以看到下图所示的垂直线：</p>

<p>为background-image图片（for 等高布局）：</p>

<p>从bg_line.png这样的命名可以预知（不是：home_bg_line.png），该背景图片会在（可以在）网站中多处使用。</p>

<p>图示平铺图片地址为：http://upload.chinaz.com/2012/0606/1338961513462.png</p>

<p>大小1 * 1 像素，png格式，大小88字节。//zxx： 当图片颜色简单到一定程度的时候，gif格式图片大小要小于png8， 所以，这个点如果保存成gif格式，只需要43字节，为png一半大小</p>

<p>像这种图片大小极小，但又占据了一次HTTP请求，同时不能与其他背景图片Sprite，而网站很多地方都使用。因此，没有什么背景图片比这个更适合使用本文的“base64:URL图片”技术进行优化了！</p>

<p>为了比对优化的好处，我们来看个实际的demo.</p>

<p>六、base64:URL图片的实际应用</p>

<p>我博客首页的个人信息介绍处的虚点是使用背景图片实现的（考虑到IE6 dot边框跟dashed搞基，不同浏览器虚点间距差异等）。</p>

<p>现在，demo就要展示如何使用base64:URL图片实现该虚点效果。</p>

<p>您可以狠狠地点击这里：base64 URL虚点背景demo</p>

<p>相关CSS代码如下：</p>

<p>.dot {</p>

<p>background-image: url(data:image/gif;base64,R0lGODlhBAABAIABAMLBwfLx8SH5BAEAAAEALAAAAAAEAAEAAAICRF4AOw==);</p>

<p>*background-image: url(“http://upload.chinaz.com/2012/0606/1338961513409.gif”); // IE6~IE7</p>

<p>background-repeat: repeat-x;</p>

<p>background-position: left bottom;</p>

<p>}</p>

<p>可以看到，使用base64的CSS代码量基本上跟下面使用完整地址差不多，因此，对于一些级小尺寸图片，所谓增加CSS文件大小的不足可以忽略（再考虑到gzip），同时减少了1个HTTP请求，加上这个图片网站很多地方使用，因此，累积节约的HTTP请求就很惊人了。</p>

<p>当然，唯一美中不足的是，对于IE6~IE7浏览器不能享受到这种“百利仅一害”的优化技术，我们还需要专门为它们擦屁股。不过，权衡来看，还是很值得的，毕竟目前，在中国IE8浏览器是大头（就在最近），IE6，IE7 就乖乖地泻下去吧。</p>

<p>最后，展示下demo页面YSLOW分析图吧，可以看到，没有任何CSS background-image请求。</p>

<p>没有CSS 背景图片的请求 张鑫旭-鑫空间-鑫生活</p>

<p>再次提醒下，使用base64编码代替CSS背景图片是有局限性的，并不是所有图片都适合使用base64编码这种技术的。例如：</p>

<ol>
  <li>
    <p>CSS Sprite图片后期维护会死人，只能是独立图片</p>
  </li>
  <li>
    <p>图片尺寸过大，CSS文件就会变成了臃肿的大棒子，反而不利于加载</p>
  </li>
  <li>
    <p>CSS文件的优点就是重用，因此，如果背景图片就一个地方使用，减少的请求数有限，考虑到其他成本，还不如直接使用普通url图片地址</p>
  </li>
  <li>
    <p>如果图片经常改动，好吧，哥们，苦逼的前端加班仔中就多了一个你</p>
  </li>
</ol>

<p>因此，技术本身虽好，需天时地利人和方可使用。</p>

    </div>

    

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#HTML-ref">HTML <span>1</span></a></li>
    
  



    </ul>
    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/2015/04/06/GO%20Lang" title="GO Lang">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next"><a href="/2015/04/14/SVN%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8" title="SVN命令使用">Next &raquo;</a></li>
    
    </ul>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>请启动JavaScript脚本 <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">博客评论使用 <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>

    </div>

    <!-- 
    <div id="footer">
      <div class="container">
        <p>&copy; 2015 GuoQing. Lai.
        </p>
      </div>
    </div> 
    -->

    <footer class="footer">

  <p>&lt;3</p>
  <!-- 
  <p>Heavily inspired by <a href="https://github.com/necolas/idiomatic-css">Idiomatic CSS</a> and the <a href="http://github.com/styleguide">GitHub Styleguide</a>. Made with all the love in the world by <a href="https://twitter.com/mdo">@mdo</a>.</p>
 -->
  <p>Open sourced under MIT. Copyright 2015 <a href="https://twitter.com/mdo">@mdo</a>.</p>
  
<!-- 
  <ul class="quick-links">
    <li>
      <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=mdo&repo=code-guide&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="112px" height="20px"></iframe>
    </li>
    <li>
      <iframe class="github-btn" src="http://ghbtns.com/github-btn.html?user=mdo&repo=code-guide&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="98px" height="20px"></iframe>
    </li>
  </ul>
  <ul class="quick-links">
    <li class="follow-btn">
      <a href="https://twitter.com/mdo" class="twitter-follow-button" data-link-color="#0069D6" data-show-count="true">Follow @mdo</a>
    </li>
    <li class="tweet-btn">
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="" data-count="horizontal" data-via="mdo">Tweet</a>
    </li>
  </ul>
   -->
   
</footer>


    


    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

